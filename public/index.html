<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CSPRNG Live Final</title>
</head>
<body>
  <h2>üé≤ CSPRNG Live Final</h2>
  <div id="clock"></div>
  <div id="countdown"></div>
  <div id="current"></div>
  <div id="previous"></div>
  <div id="tokens"></div>
  <div id="freq"></div>
  <div id="history"></div>

<script>
const ws = new WebSocket(`wss://${location.host}`);

ws.onmessage = (msg) => {
  const data = JSON.parse(msg.data);
  if (data.type === "preview") {
    document.getElementById("current").innerText =
      `üîÆ Preview Result: ${data.preview}`;
    document.getElementById("tokens").innerText =
      `25 Tokens: ${data.tokens.join(", ")}`;
    document.getElementById("freq").innerText =
      `Frequency: ${JSON.stringify(data.freq)}`;
    document.getElementById("previous").innerText =
      `Prev: ${data.previous}`;
  }

  if (data.type === "final") {
    document.getElementById("current").innerText =
      `‚úÖ Final Result: ${data.result}`;
    document.getElementById("tokens").innerText =
      `25 Tokens: ${data.tokens.join(", ")}`;
    document.getElementById("freq").innerText =
      `Frequency: ${JSON.stringify(data.freq)}`;
    document.getElementById("previous").innerText =
      `Prev: ${data.previous}`;
    document.getElementById("history").innerText =
      `üìú History: ${data.history.join(", ")}`;
  }
};

// realtime clock + countdown
setInterval(() => {
  const now = new Date();
  const sec = now.getUTCSeconds();
  const countdown = 60 - sec;
  document.getElementById("clock").innerText =
    `‚è∞ UTC Time: ${now.toISOString().substr(11,8)}`;
  document.getElementById("countdown").innerText =
    `‚åõ Countdown: ${countdown}s`;
}, 1000);
</script>
</body>
</html>
